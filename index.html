<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyncTime | Professional Global Meeting Planner & Timezone Sync</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="SyncTime is a professional open-source global meeting planner. Easily synchronize time across 400+ world cities and schedule meetings in Google Meet or Microsoft Teams instantly.">
    <meta name="keywords"
        content="timezone sync, global meeting planner, time calculator, world clock, schedule meetings, google meet, microsoft teams, open source">
    <meta name="author" content="Mohamed Sajaath">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="SyncTime | Global Meeting Planner">
    <meta property="og:description"
        content="Coordinate across timezones seamlessly. The essential tool for distributed teams.">
    <meta property="og:image" content="synctime_logo.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="synctime_logo.png">

    <!-- Oat UI Library -->
    <link rel="stylesheet" href="https://unpkg.com/@knadh/oat/oat.min.css">

    <!-- Searchable Select Dependencies -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        :root {
            --oat-accent: var(--accent-color, #0a84ff);
            --wheel-height: 160px;
            --item-height: 40px;
        }

        body {
            background-color: #f4f4f7;
            padding: 2rem;
            min-height: 100vh;
        }

        .app-container {
            margin: 0 auto;
        }

        .header-section {
            margin-bottom: 1rem;
            text-align: center;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: #1a1a1b;
        }

        .header-section p {
            color: #666;
            font-size: 1.1rem;
        }

        .controls-card {
            background: white;
            padding: 1rem;
            display: inline-flex;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-top: 1.5rem;
            align-items: center;
            width: 100%;
            justify-content: center;
        }

        #dials-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .dial-card {
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .dial-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        /* Apple Style Wheel Picker */
        .picker-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 12px;
            height: var(--wheel-height);
            position: relative;
            overflow: hidden;
            user-select: none;
            margin: 1rem 0;
            padding: 0 8px;
        }

        .wheel-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            position: relative;
        }

        .picker-column {
            width: 100%;
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            position: relative;
            mask-image: linear-gradient(to bottom, transparent, black 40%, black 60%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 40%, black 60%, transparent);
        }

        .picker-column::-webkit-scrollbar {
            display: none;
        }

        .chevron-btn {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            padding: 4px;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 30px;
            transition: color 0.2s, background 0.2s;
        }

        .chevron-btn:hover {
            color: var(--oat-accent);
            background: rgba(0, 0, 0, 0.02);
        }

        .chevron-up {
            top: 0;
        }

        .chevron-down {
            bottom: 0;
        }

        .picker-spacer {
            height: calc((var(--wheel-height) - var(--item-height)) / 2);
        }

        .picker-item {
            height: var(--item-height);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 500;
            scroll-snap-align: center;
            color: #ddd;
            transition: color 0.1s, transform 0.1s;
            transform-origin: center center;
            backface-visibility: hidden;
        }

        .picker-item.active {
            color: #1a1a1b;
            font-weight: 700;
        }

        .picker-separator {
            font-size: 1.6rem;
            font-weight: 700;
            color: #1a1a1b;
            margin-top: -2px;
        }

        .picker-selection-bar {
            position: absolute;
            top: 50%;
            left: 12px;
            right: 12px;
            height: var(--item-height);
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.03);
            border-radius: 8px;
            pointer-events: none;
            border: 1px solid rgba(0, 0, 0, 0.02);
        }

        .card-remove-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 4px 8px;
            font-size: 0.8rem;
            opacity: 0.3;
            transition: opacity 0.2s;
        }

        .dial-card:hover .card-remove-btn {
            opacity: 1;
        }

        .city-title {
            font-size: 1rem;
            font-weight: 700;
            color: #1a1a1b;
        }

        .tz-subtitle {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .app-footer {
            margin-top: 4rem;
            padding: 2rem 0;
            border-top: 1px solid #eee;
            width: 100%;
            text-align: center;
            color: #888;
            font-size: 0.9rem;


        }

        .app-footer a {
            color: var(--oat-accent);
            text-decoration: none;
            font-weight: 500;
        }

        .app-footer a:hover {
            text-decoration: underline;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 0.5rem;
        }

        /* Select2 Theme Fixes for Oat UI */
        .select2-container--default .select2-selection--single {
            height: 42px;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            background: white;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 40px;
        }

        .select2-dropdown {
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .select2-search__field {
            border-radius: 6px !important;
            border: 1px solid #eee !important;
        }

        .select2-container .select2-selection--single .select2-selection__rendered {
            padding-left: 12px;
            color: #1a1a1b;
        }

        /* Premium Modal Styling */
        dialog#schedule-modal {
            border: none;
            border-radius: 20px;
            padding: 0;
            width: 440px;
            max-width: 90vw;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        dialog#schedule-modal::backdrop {
            background: rgba(15, 23, 42, 0.3);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .modal-content-wrapper {
            padding: 1rem;
            overflow-y: auto;
            flex: 1;
        }

        .modal-header-icon {
            width: 48px;
            height: 48px;
            background: #f8fafc;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            color: var(--oat-accent);
        }

        .modal-footer {
            background: #f8fafc;
            padding: 1rem;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 1px solid #f1f5f9;
        }

        #modal-confirm-btn {
            background: var(--oat-accent);
            color: white;
            font-weight: 600;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        #modal-confirm-btn:active {
            transform: scale(0.98);
        }

        .modal-close-btn {
            background: #f1f5f9;
            color: #475569;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
        }

        @media (max-width: 480px) {
            body {
                padding: 1rem;
            }

            #dials-container {
                grid-template-columns: 1fr;
            }

            .app-footer {
                margin-top: 2rem;
            }
        }
    </style>
</head>

<body>

    <div class="app-container">
        <header class="header-section">
            <div class="controls-card card">
                <div data-field style="margin: 0; min-width: 40%;">
                    <select id="tz-selector"></select>
                </div>
                <button id="add-btn" class="primary">Add Location</button>
                <button id="meet-btn" class="outline"
                    style="border-color: #4285f4; color: #4285f4; display: flex; align-items: center; gap: 8px;">
                    <svg fill="none" width="20" height="20" xmlns="http://www.w3.org/2000/svg"
                        viewBox="-13.1265 -18 113.763 108">
                        <path fill="#00832d" d="M49.5 36l8.53 9.75 11.47 7.33 2-17.02-2-16.64-11.69 6.44z" />
                        <path fill="#0066da" d="M0 51.5V66c0 3.315 2.685 6 6 6h14.5l3-10.96-3-9.54-9.95-3z" />
                        <path fill="#e94235" d="M20.5 0L0 20.5l10.55 3 9.95-3 2.95-9.41z" />
                        <path fill="#2684fc" d="M20.5 20.5H0v31h20.5z" />
                        <path fill="#00ac47"
                            d="M82.6 8.68L69.5 19.42v33.66l13.16 10.79c1.97 1.54 4.85.135 4.85-2.37V11c0-2.535-2.945-3.925-4.91-2.32zM49.5 36v15.5h-29V72h43c3.315 0 6-2.685 6-6V53.08z" />
                        <path fill="#ffba00" d="M63.5 0h-43v20.5h29V36l20-16.57V6c0-3.315-2.685-6-6-6z" />
                    </svg>
                    Google Meet
                </button>
                <button id="teams-btn" class="outline"
                    style="border-color: #4B53BC; color: #4B53BC; display: flex; align-items: center; gap: 8px;">
                    <svg width="20px" height="20px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="none">
                        <path fill="#5059C9"
                            d="M10.765 6.875h3.616c.342 0 .619.276.619.617v3.288a2.272 2.272 0 01-2.274 2.27h-.01a2.272 2.272 0 01-2.274-2.27V7.199c0-.179.145-.323.323-.323zM13.21 6.225c.808 0 1.464-.655 1.464-1.462 0-.808-.656-1.463-1.465-1.463s-1.465.655-1.465 1.463c0 .807.656 1.462 1.465 1.462z" />
                        <path fill="#7B83EB"
                            d="M8.651 6.225a2.114 2.114 0 002.117-2.112A2.114 2.114 0 008.65 2a2.114 2.114 0 00-2.116 2.112c0 1.167.947 2.113 2.116 2.113zM11.473 6.875h-5.97a.611.611 0 00-.596.625v3.75A3.669 3.669 0 008.488 15a3.669 3.669 0 003.582-3.75V7.5a.611.611 0 00-.597-.625z" />
                        <path fill="#000000"
                            d="M8.814 6.875v5.255a.598.598 0 01-.596.595H5.193a3.951 3.951 0 01-.287-1.476V7.5a.61.61 0 01.597-.624h3.31z"
                            opacity=".1" />
                        <path fill="#000000"
                            d="M8.488 6.875v5.58a.6.6 0 01-.596.595H5.347a3.22 3.22 0 01-.267-.65 3.951 3.951 0 01-.172-1.15V7.498a.61.61 0 01.596-.624h2.985z"
                            opacity=".2" />
                        <path fill="#000000"
                            d="M8.488 6.875v4.93a.6.6 0 01-.596.595H5.08a3.951 3.951 0 01-.172-1.15V7.498a.61.61 0 01.596-.624h2.985z"
                            opacity=".2" />
                        <path fill="#000000"
                            d="M8.163 6.875v4.93a.6.6 0 01-.596.595H5.079a3.951 3.951 0 01-.172-1.15V7.498a.61.61 0 01.596-.624h2.66z"
                            opacity=".2" />
                        <path fill="#000000"
                            d="M8.814 5.195v1.024c-.055.003-.107.006-.163.006-.055 0-.107-.003-.163-.006A2.115 2.115 0 016.593 4.6h1.625a.598.598 0 01.596.594z"
                            opacity=".1" />
                        <path fill="#000000"
                            d="M8.488 5.52v.699a2.115 2.115 0 01-1.79-1.293h1.195a.598.598 0 01.595.594z"
                            opacity=".2" />
                        <path fill="#000000"
                            d="M8.488 5.52v.699a2.115 2.115 0 01-1.79-1.293h1.195a.598.598 0 01.595.594z"
                            opacity=".2" />
                        <path fill="#000000"
                            d="M8.163 5.52v.647a2.115 2.115 0 01-1.465-1.242h.87a.598.598 0 01.595.595z" opacity=".2" />
                        <path fill="url(#microsoft-teams-color-16__paint0_linear_2372_494)"
                            d="M1.597 4.925h5.969c.33 0 .597.267.597.596v5.958a.596.596 0 01-.597.596h-5.97A.596.596 0 011 11.479V5.521c0-.33.267-.596.597-.596z" />
                        <path fill="#ffffff" d="M6.152 7.193H4.959v3.243h-.76V7.193H3.01v-.63h3.141v.63z" />
                        <defs>
                            <linearGradient id="microsoft-teams-color-16__paint0_linear_2372_494" x1="2.244" x2="6.906"
                                y1="4.46" y2="12.548" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#5A62C3" />
                                <stop offset=".5" stop-color="#4D55BD" />
                                <stop offset="1" stop-color="#3940AB" />
                            </linearGradient>
                        </defs>
                    </svg>
                    Microsoft Teams
                </button>
            </div>
        </header>

        <main id="dials-container"></main>

        <!-- Professional Scheduling Modal -->
        <dialog id="schedule-modal" class="card">
            <div class="modal-content-wrapper">
                <div class="modal-header-icon" id="modal-platform-icon">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                </div>

                <header style="margin-bottom: 2rem;">
                    <h2 id="modal-title-label"
                        style="font-size: 1.5rem; font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">Schedule
                        Meeting</h2>
                    <p style="color: #64748b; font-size: 0.95rem; line-height: 1.5;">Customize your invitation details
                        before we generate the calendar event.</p>
                </header>

                <form method="dialog" style="display: flex; flex-direction: column; gap: 1.5rem;">

                    <label style="display: block;">
                        <span
                            style="display: block; font-weight: 600; color: #334155; margin-bottom: 8px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em;">Meeting
                            Subject</span>
                        <input type="text" id="modal-meeting-subject"
                            style="width: 100%; padding: 0.8rem 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: border-color 0.2s;"
                            placeholder="e.g. Design Sync" value="Global Sync Meeting">
                    </label>

                    <label style="display: block;">
                        <span
                            style="display: block; font-weight: 600; color: #334155; margin-bottom: 8px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em;">Description
                            / Agenda</span>
                        <textarea id="modal-meeting-desc" rows="3"
                            style="width: 100%; padding: 0.8rem 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; font-family: inherit; resize: none;"
                            placeholder="Add meeting notes...">Meeting scheduled via SyncTime</textarea>
                    </label>

                    <!-- Dynamic Timezone Summary -->
                    <div id="modal-timezone-summary"
                        style="background: #f8fafc; padding: 1.25rem; border-radius: 12px; border: 1px solid #e2e8f0;">
                    </div>

                </form>
            </div>

            <footer class="modal-footer">
                <button type="button" class="modal-close-btn"
                    onclick="document.getElementById('schedule-modal').close()">Cancel</button>
                <button type="button" id="modal-confirm-btn">Schedule</button>
            </footer>
        </dialog>

        <footer class="app-footer">
            <div class="footer-links">
                <a href="https://github.com/mohamedsajaath" target="_blank">
                    <svg style="vertical-align: middle; margin-right: 4px;" width="16" height="16" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path
                            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                    </svg>
                    GitHub
                </a>
                <a href="#">MIT License</a>
                <a href="https://oat.ink" target="_blank">Built with Oat UI</a>
            </div>
            <p>SyncTime © 2026. Made with ❤️ by <a href="https://github.com/mohamedsajaath" target="_blank">Mohamed
                    Sajaath</a></p>
        </footer>
    </div>

    <script>
        /**
         * GLOBAL STATE
         */
        let currentUTC = new Date();
        let activeDials = [];
        let isGlobalUpdating = false;

        // Get all supported IANA timezones from the browser
        const ALL_TIMEZONES = Intl.supportedValuesOf('timeZone');

        // Professional mapping for countries and major cities mapping to their primary timezones
        const MAJOR_CITIES_MAPPING = [
            { name: "Afghanistan (Kabul)", tz: "Asia/Kabul" },
            { name: "Albania (Tirane)", tz: "Europe/Tirane" },
            { name: "Algeria (Algiers)", tz: "Africa/Algiers" },
            { name: "Andorra", tz: "Europe/Andorra" },
            { name: "Angola (Luanda)", tz: "Africa/Luanda" },
            { name: "Argentina (Buenos Aires)", tz: "America/Argentina/Buenos_Aires" },
            { name: "Armenia (Yerevan)", tz: "Asia/Yerevan" },
            { name: "Australia (Sydney)", tz: "Australia/Sydney" },
            { name: "Austria (Vienna)", tz: "Europe/Vienna" },
            { name: "Azerbaijan (Baku)", tz: "Asia/Baku" },
            { name: "Bangladesh (Dhaka)", tz: "Asia/Dhaka" },
            { name: "Belarus (Minsk)", tz: "Europe/Minsk" },
            { name: "Belgium (Brussels)", tz: "Europe/Brussels" },
            { name: "Bolivia (La Paz)", tz: "America/La_Paz" },
            { name: "Bosnia and Herzegovina (Sarajevo)", tz: "Europe/Sarajevo" },
            { name: "Brazil (Sao Paulo)", tz: "America/Sao_Paulo" },
            { name: "Bulgaria (Sofia)", tz: "Europe/Sofia" },
            { name: "Cambodia (Phnom Penh)", tz: "Asia/Phnom_Penh" },
            { name: "Canada (Toronto)", tz: "America/Toronto" },
            { name: "Chile (Santiago)", tz: "America/Santiago" },
            { name: "China (Beijing)", tz: "Asia/Shanghai" },
            { name: "Colombia (Bogota)", tz: "America/Bogota" },
            { name: "Costa Rica", tz: "America/Costa_Rica" },
            { name: "Croatia (Zagreb)", tz: "Europe/Zagreb" },
            { name: "Cuba (Havana)", tz: "America/Havana" },
            { name: "Cyprus (Nicosia)", tz: "Asia/Nicosia" },
            { name: "Czech Republic (Prague)", tz: "Europe/Prague" },
            { name: "Denmark (Copenhagen)", tz: "Europe/Copenhagen" },
            { name: "Dominican Republic (Santo Domingo)", tz: "America/Santo_Domingo" },
            { name: "Ecuador (Quito)", tz: "America/Guayaquil" },
            { name: "Egypt (Cairo)", tz: "Africa/Cairo" },
            { name: "Estonia (Tallinn)", tz: "Europe/Tallinn" },
            { name: "Ethiopia (Addis Ababa)", tz: "Africa/Addis_Ababa" },
            { name: "Finland (Helsinki)", tz: "Europe/Helsinki" },
            { name: "France (Paris)", tz: "Europe/Paris" },
            { name: "Georgia (Tbilisi)", tz: "Asia/Tbilisi" },
            { name: "Germany (Berlin)", tz: "Europe/Berlin" },
            { name: "Ghana (Accra)", tz: "Africa/Accra" },
            { name: "Greece (Athens)", tz: "Europe/Athens" },
            { name: "Guatemala", tz: "America/Guatemala" },
            { name: "Honduras", tz: "America/Tegucigalpa" },
            { name: "Hungary (Budapest)", tz: "Europe/Budapest" },
            { name: "Iceland (Reykjavik)", tz: "Atlantic/Reykjavik" },
            { name: "India (New Delhi)", tz: "Asia/Kolkata" },
            { name: "Indonesia (Jakarta)", tz: "Asia/Jakarta" },
            { name: "Iran (Tehran)", tz: "Asia/Tehran" },
            { name: "Iraq (Baghdad)", tz: "Asia/Baghdad" },
            { name: "Ireland (Dublin)", tz: "Europe/Dublin" },
            { name: "Israel (Tel Aviv)", tz: "Asia/Jerusalem" },
            { name: "Italy (Rome)", tz: "Europe/Rome" },
            { name: "Jamaica (Kingston)", tz: "America/Jamaica" },
            { name: "Japan (Tokyo)", tz: "Asia/Tokyo" },
            { name: "Jordan (Amman)", tz: "Asia/Amman" },
            { name: "Kazakhstan (Almaty)", tz: "Asia/Almaty" },
            { name: "Kenya (Nairobi)", tz: "Africa/Nairobi" },
            { name: "Korea, South (Seoul)", tz: "Asia/Seoul" },
            { name: "Kuwait", tz: "Asia/Kuwait" },
            { name: "Kyrgyzstan (Bishkek)", tz: "Asia/Bishkek" },
            { name: "Latvia (Riga)", tz: "Europe/Riga" },
            { name: "Lebanon (Beirut)", tz: "Asia/Beirut" },
            { name: "Libya (Tripoli)", tz: "Africa/Tripoli" },
            { name: "Lithuania (Vilnius)", tz: "Europe/Vilnius" },
            { name: "Luxembourg", tz: "Europe/Luxembourg" },
            { name: "Malaysia (Kuala Lumpur)", tz: "Asia/Kuala_Lumpur" },
            { name: "Malta", tz: "Europe/Malta" },
            { name: "Mexico (Mexico City)", tz: "America/Mexico_City" },
            { name: "Moldova (Chisinau)", tz: "Europe/Chisinau" },
            { name: "Monaco", tz: "Europe/Monaco" },
            { name: "Mongolia (Ulaanbaatar)", tz: "Asia/Ulaanbaatar" },
            { name: "Morocco (Casablanca)", tz: "Africa/Casablanca" },
            { name: "Myanmar (Yangon)", tz: "Asia/Yangon" },
            { name: "Nepal (Kathmandu)", tz: "Asia/Kathmandu" },
            { name: "Netherlands (Amsterdam)", tz: "Europe/Amsterdam" },
            { name: "New Zealand (Auckland)", tz: "Pacific/Auckland" },
            { name: "Nicaragua", tz: "America/Managua" },
            { name: "Nigeria (Lagos)", tz: "Africa/Lagos" },
            { name: "Norway (Oslo)", tz: "Europe/Oslo" },
            { name: "Oman (Muscat)", tz: "Asia/Muscat" },
            { name: "Pakistan (Karachi)", tz: "Asia/Karachi" },
            { name: "Panama", tz: "America/Panama" },
            { name: "Paraguay (Asuncion)", tz: "America/Asuncion" },
            { name: "Peru (Lima)", tz: "America/Lima" },
            { name: "Philippines (Manila)", tz: "Asia/Manila" },
            { name: "Poland (Warsaw)", tz: "Europe/Warsaw" },
            { name: "Portugal (Lisbon)", tz: "Europe/Lisbon" },
            { name: "Qatar (Doha)", tz: "Asia/Qatar" },
            { name: "Romania (Bucharest)", tz: "Europe/Bucharest" },
            { name: "Russia (Moscow)", tz: "Europe/Moscow" },
            { name: "Saudi Arabia (Riyadh)", tz: "Asia/Riyadh" },
            { name: "Senegal (Dakar)", tz: "Africa/Dakar" },
            { name: "Serbia (Belgrade)", tz: "Europe/Belgrade" },
            { name: "Singapore", tz: "Asia/Singapore" },
            { name: "Slovakia (Bratislava)", tz: "Europe/Bratislava" },
            { name: "Slovenia (Ljubljana)", tz: "Europe/Ljubljana" },
            { name: "South Africa (Johannesburg)", tz: "Africa/Johannesburg" },
            { name: "Spain (Madrid)", tz: "Europe/Madrid" },
            { name: "Sri Lanka (Colombo)", tz: "Asia/Colombo" },
            { name: "Sudan (Khartoum)", tz: "Africa/Khartoum" },
            { name: "Sweden (Stockholm)", tz: "Europe/Stockholm" },
            { name: "Switzerland (Zurich)", tz: "Europe/Zurich" },
            { name: "Syria (Damascus)", tz: "Asia/Damascus" },
            { name: "Taiwan (Taipei)", tz: "Asia/Taipei" },
            { name: "Thailand (Bangkok)", tz: "Asia/Bangkok" },
            { name: "Tunisia (Tunis)", tz: "Africa/Tunis" },
            { name: "Turkey (Istanbul)", tz: "Europe/Istanbul" },
            { name: "Ukraine (Kyiv)", tz: "Europe/Kyiv" },
            { name: "United Arab Emirates (Dubai)", tz: "Asia/Dubai" },
            { name: "United Kingdom (London)", tz: "Europe/London" },
            { name: "United States (New York)", tz: "America/New_York" },
            { name: "United States (Los Angeles)", tz: "America/Los_Angeles" },
            { name: "Uruguay (Montevideo)", tz: "America/Montevideo" },
            { name: "Uzbekistan (Tashkent)", tz: "Asia/Tashkent" },
            { name: "Vatican City", tz: "Europe/Vatican" },
            { name: "Venezuela (Caracas)", tz: "America/Caracas" },
            { name: "Vietnam (Ho Chi Minh)", tz: "Asia/Ho_Chi_Minh" },
            { name: "Yemen (Aden)", tz: "Asia/Aden" },
            { name: "Zambia (Lusaka)", tz: "Africa/Lusaka" },
            { name: "Zimbabwe (Harare)", tz: "Africa/Harare" },
            // Cities
            { name: "Beijing, China", tz: "Asia/Shanghai" },
            { name: "Mumbai, India", tz: "Asia/Kolkata" },
            { name: "Delhi, India", tz: "Asia/Kolkata" },
            { name: "Washington DC, USA", tz: "America/New_York" },
            { name: "San Francisco, USA", tz: "America/Los_Angeles" }
        ];

        function getTZComponents(date, timezone) {
            const parts = new Intl.DateTimeFormat('en-US', {
                year: 'numeric', month: 'numeric', day: 'numeric',
                hour: 'numeric', minute: 'numeric', second: 'numeric',
                hour12: false, timeZone: timezone
            }).formatToParts(date);
            const map = {};
            parts.forEach(p => map[p.type] = p.value);
            return map;
        }

        function updateMasterFromLocal(timezone, year, month, day, hours, minutes) {
            if (isGlobalUpdating) return;

            const wallClockInUTC = new Date(Date.UTC(year, month - 1, day, hours, minutes));
            const offsetDate = new Date(wallClockInUTC.toLocaleString('en-US', { timeZone: 'UTC' }));
            const tzDate = new Date(wallClockInUTC.toLocaleString('en-US', { timeZone: timezone }));
            const offsetMs = offsetDate.getTime() - tzDate.getTime();

            currentUTC = new Date(wallClockInUTC.getTime() + offsetMs);
            broadcastSync();
        }

        function init() {
            // Initialize Searchable Dropdown
            $('#tz-selector').select2({
                placeholder: 'Search any city or country...',
                width: '100%'
            });

            const localTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
            addDial(localTZ, true);

            document.getElementById('add-btn').onclick = () => {
                const val = $('#tz-selector').val();
                if (val) {
                    addDial(val);
                }
            };

            document.getElementById('meet-btn').onclick = () => {
                pendingPlatform = 'google';
                document.getElementById('modal-title-label').textContent = 'Schedule Google Meet';
                document.getElementById('modal-platform-icon').innerHTML = document.querySelector('#meet-btn svg').outerHTML;
                updateModalSummary();
                document.getElementById('schedule-modal').showModal();
            };

            document.getElementById('teams-btn').onclick = () => {
                pendingPlatform = 'teams';
                document.getElementById('modal-title-label').textContent = 'Schedule Microsoft Teams';
                document.getElementById('modal-platform-icon').innerHTML = document.querySelector('#teams-btn svg').outerHTML;
                updateModalSummary();
                document.getElementById('schedule-modal').showModal();
            };

            document.getElementById('modal-confirm-btn').onclick = () => {
                const subject = document.getElementById('modal-meeting-subject').value || "Global Sync Meeting";
                const userDesc = document.getElementById('modal-meeting-desc').value || "";

                // Construct the full description including the summary
                let fullDesc = userDesc + "\n\n--- Timezone Summary ---\n";
                activeDials.forEach(dial => {
                    const comp = getTZComponents(currentUTC, dial.timezone);
                    const location = dial.timezone.replace(/_/g, ' ').split('/').reverse().join(', ');
                    fullDesc += `${location}: ${comp.hour.padStart(2, '0')}:${comp.minute.padStart(2, '0')} (${comp.day}/${comp.month}/${comp.year})\n`;
                });

                const start = new Date(currentUTC);
                const end = new Date(currentUTC.getTime() + (60 * 1000 * 60)); // 1 hour duration

                if (pendingPlatform === 'google') {
                    const format = (d) => d.toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";
                    const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(subject)}&dates=${format(start)}/${format(end)}&details=${encodeURIComponent(fullDesc)}&add=googlevideomeet`;
                    window.open(url, '_blank');
                } else {
                    const startISO = start.toISOString();
                    const endISO = end.toISOString();
                    const url = `https://outlook.office.com/calendar/0/deeplink/compose?path=/calendar/action/compose&rru=addevent&subject=${encodeURIComponent(subject)}&startdt=${startISO}&enddt=${endISO}&body=${encodeURIComponent(fullDesc)}`;
                    window.open(url, '_blank');
                }

                document.getElementById('schedule-modal').close();
            };
        }

        let pendingPlatform = 'google';

        function updateModalSummary() {
            const container = document.getElementById('modal-timezone-summary');
            if (!container) return;

            container.innerHTML = '<span style="display: block; font-weight: 600; color: #64748b; margin-bottom: 12px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">Meeting Time Overview</span>';

            activeDials.forEach(dial => {
                const comp = getTZComponents(currentUTC, dial.timezone);
                const timeStr = `${comp.hour.padStart(2, '0')}:${comp.minute.padStart(2, '0')}`;
                const cityName = dial.timezone.split('/').pop().replace(/_/g, ' ');

                const row = document.createElement('div');
                row.style.display = 'flex';
                row.style.justifyContent = 'space-between';
                row.style.alignItems = 'center';
                row.style.marginBottom = '6px';
                row.style.fontSize = '0.9rem';

                row.innerHTML = `
                    <span style="color: #475569; font-weight: 500;">${cityName} ${dial.isLocal ? '(Me)' : ''}</span>
                    <span style="color: #1e293b; font-weight: 700; font-variant-numeric: tabular-nums;">${timeStr}</span>
                `;
                container.appendChild(row);
            });
        }

        function resetToNow() {
            currentUTC = new Date();
            broadcastSync();
        }

        function populateDropdown() {
            const $selector = $('#tz-selector');
            $selector.empty();

            const activeTimezones = activeDials.map(d => d.timezone);

            // 1. Add Major City Aliases
            MAJOR_CITIES_MAPPING.forEach(city => {
                if (!activeTimezones.includes(city.tz)) {
                    const opt = new Option(city.name, city.tz, false, false);
                    $selector.append(opt);
                }
            });

            // 2. Add full IANA list
            const rawZones = ALL_TIMEZONES.filter(tz => !activeTimezones.includes(tz));
            rawZones.forEach(tz => {
                const cleanName = tz.replace(/_/g, ' ').split('/').reverse().join(', ');
                const opt = new Option(cleanName, tz, false, false);
                $selector.append(opt);
            });

            if ($selector.children().length === 0) {
                const opt = new Option("All zones added", "", false, false);
                opt.disabled = true;
                $selector.append(opt);
                document.getElementById('add-btn').disabled = true;
            } else {
                document.getElementById('add-btn').disabled = false;
            }
            $selector.trigger('change');
        }

        function addDial(timezone, isLocal = false) {
            const id = "dial-" + Date.now() + Math.floor(Math.random() * 1000);
            const dial = { id, timezone, isLocal };
            activeDials.push(dial);

            const card = createCardMarkup(dial);
            document.getElementById('dials-container').appendChild(card);

            syncCardToGlobal(dial.id);
            populateDropdown();
        }

        function removeDial(id) {
            activeDials = activeDials.filter(d => d.id !== id);
            document.getElementById(id).remove();
            populateDropdown();
        }

        function createCardMarkup(dial) {
            const card = document.createElement('article');
            card.className = 'dial-card card';
            card.id = dial.id;

            card.innerHTML = `
                <header>
                    <div class="city-title">
                        ${dial.timezone.replace(/_/g, ' ').split('/').reverse().join(', ')} 
                        ${dial.isLocal ? '<span style="color: var(--oat-accent); font-weight: normal; font-size: 0.8rem; margin-left: 8px;">(Me)</span>' : ''}
                    </div>
                    <div class="tz-subtitle">${dial.timezone}</div>
                    ${dial.isLocal ? `<button class="reset-btn outline" onclick="resetToNow()" style="margin-top: 8px; font-size: 0.75rem; padding: 4px 8px;">Reset to Now</button>` : ''}
                </header>
                ${!dial.isLocal ? `<button class="card-remove-btn outline danger" onclick="removeDial('${dial.id}')">Remove</button>` : ''}
                
                <div class="picker-container">
                    <div class="picker-selection-bar"></div>
                    
                    <div class="wheel-group">
                        <button class="chevron-btn chevron-up">▲</button>
                        <div class="picker-column hour-wheel"></div>
                        <button class="chevron-btn chevron-down">▼</button>
                    </div>

                    <div class="picker-separator">:</div>
                    
                    <div class="wheel-group">
                        <button class="chevron-btn chevron-up">▲</button>
                        <div class="picker-column min-wheel"></div>
                        <button class="chevron-btn chevron-down">▼</button>
                    </div>
                </div>

                <footer>
                    <label data-field>
                        Date
                        <input type="date" class="card-date-input">
                    </label>
                </footer>
            `;

            const hWheel = card.querySelector('.hour-wheel');
            const mWheel = card.querySelector('.min-wheel');
            const dateInput = card.querySelector('.card-date-input');

            // Populate wheels
            fillWheel(hWheel, 24);
            fillWheel(mWheel, 60);

            // Bind Events
            hWheel.addEventListener('scroll', () => onWheelScroll(dial.id, hWheel));
            mWheel.addEventListener('scroll', () => onWheelScroll(dial.id, mWheel));

            // Chevron Click Handlers
            card.querySelectorAll('.wheel-group').forEach((group, idx) => {
                const column = group.querySelector('.picker-column');
                group.querySelector('.chevron-up').onclick = () => shiftWheel(column, -1);
                group.querySelector('.chevron-down').onclick = () => shiftWheel(column, 1);
            });

            dateInput.onchange = () => {
                const hour = Math.round(hWheel.scrollTop / 40);
                const min = Math.round(mWheel.scrollTop / 40);
                if (!dateInput.value) return;
                const [y, m, d] = dateInput.value.split('-').map(Number);
                updateMasterFromLocal(dial.timezone, y, m, d, hour, min);
            };

            return card;
        }

        function shiftWheel(column, direction) {
            const currentItem = Math.round(column.scrollTop / 40);
            column.scrollTo({
                top: (currentItem + direction) * 40,
                behavior: 'smooth'
            });
        }

        function fillWheel(column, count) {
            column.appendChild(Object.assign(document.createElement('div'), { className: 'picker-spacer' }));
            for (let i = 0; i < count; i++) {
                const item = document.createElement('div');
                item.className = 'picker-item';
                item.textContent = i.toString().padStart(2, '0');
                item.dataset.value = i;
                column.appendChild(item);
            }
            column.appendChild(Object.assign(document.createElement('div'), { className: 'picker-spacer' }));
        }

        let scrollSyncTimer = null;
        function onWheelScroll(dialId, column) {
            if (isGlobalUpdating) return;

            updateWheelVisuals(column);

            clearTimeout(scrollSyncTimer);
            scrollSyncTimer = setTimeout(() => {
                const card = document.getElementById(dialId);
                const dial = activeDials.find(d => d.id === dialId);
                const hWheel = card.querySelector('.hour-wheel');
                const mWheel = card.querySelector('.min-wheel');
                const dateInput = card.querySelector('.card-date-input');

                const hour = Math.round(hWheel.scrollTop / 40);
                const min = Math.round(mWheel.scrollTop / 40);
                if (!dateInput.value) return;
                const [y, m, d] = dateInput.value.split('-').map(Number);

                updateMasterFromLocal(dial.timezone, y, m, d, hour, min);
            }, 100);
        }

        function updateWheelVisuals(column) {
            const index = Math.round(column.scrollTop / 40);
            const items = column.querySelectorAll('.picker-item');
            items.forEach((item, idx) => {
                const dist = Math.abs(idx - index);
                item.classList.toggle('active', dist === 0);

                const opacity = Math.max(0.05, 1 - (dist * 0.35));
                const rotate = (idx - index) * 15;
                item.style.opacity = opacity;
                item.style.transform = `rotateX(${rotate}deg) scale(${1 - (dist * 0.05)})`;
            });
        }

        function broadcastSync() {
            isGlobalUpdating = true;
            activeDials.forEach(dial => syncCardToGlobal(dial.id));
            setTimeout(() => { isGlobalUpdating = false; }, 50);
        }

        function syncCardToGlobal(id) {
            const dial = activeDials.find(d => d.id === id);
            const card = document.getElementById(id);
            if (!card) return;

            const comp = getTZComponents(currentUTC, dial.timezone);
            const h = parseInt(comp.hour);
            const m = parseInt(comp.minute);

            const hWheel = card.querySelector('.hour-wheel');
            const mWheel = card.querySelector('.min-wheel');
            const dateInput = card.querySelector('.card-date-input');

            // Force scroll positions
            hWheel.scrollTop = h * 40;
            mWheel.scrollTop = m * 40;
            dateInput.value = `${comp.year}-${comp.month.padStart(2, '0')}-${comp.day.padStart(2, '0')}`;

            updateWheelVisuals(hWheel);
            updateWheelVisuals(mWheel);
        }

        window.removeDial = removeDial;
        init();
    </script>
</body>

</html>
